<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TON EDUCATION</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tonconnect/sdk@latest/dist/tonconnect-sdk.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #2D83EC 0%, #1AC9FF 100%);
            --ton-blue: #0088cc;
            --dark-bg: #121212;
            --light-bg: #ffffff;
            --text-dark: #212529;
            --text-light: #f8f9fa;
        }
        
        [data-theme="dark"] {
            --bg-color: var(--dark-bg);
            --text-color: var(--text-light);
            --card-bg: #1e1e1e;
        }
        
        [data-theme="light"] {
            --bg-color: var(--light-bg);
            --text-color: var(--text-dark);
            --card-bg: #f8f9fa;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            padding: 0;
            background: var(--bg-color);
            color: var(--text-color);
            transition: all 0.3s ease;
        }
        
        .gradient-bg {
            background: var(--primary-gradient);
        }
        
        .course-card {
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .course-card:hover {
            transform: translateY(-5px);
        }
        
        .progress-bar {
            height: 8px;
            border-radius: 4px;
            background: rgba(0, 0, 0, 0.1);
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 4px;
            background: var(--primary-gradient);
            transition: width 0.5s ease;
        }
        
        .news-card {
            border-left: 4px solid var(--ton-blue);
        }
        
        .certificate-badge {
            width: 24px;
            height: 24px;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .nav-tabs .nav-link.active {
            font-weight: 600;
            border-bottom: 3px solid var(--ton-blue);
        }
        
        .wallet-connected {
            width: 12px;
            height: 12px;
            background: #28a745;
            border-radius: 50%;
            display: inline-block;
        }
    </style>
</head>
<body data-theme="dark">
    <div class="container py-3">
        <!-- Loading Screen -->
        <div id="loading" class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
        
        <!-- Main App -->
        <div id="app" style="display: none;">
            <!-- Header -->
            <header class="d-flex justify-content-between align-items-center mb-4">
                <div class="d-flex align-items-center">
                    <img src="https://via.placeholder.com/40" alt="TON EDUCATION Logo" class="rounded-circle me-2" style="width: 40px; height: 40px;">
                    <h1 class="h5 mb-0">TON EDUCATION</h1>
                </div>
                <div id="walletInfo" style="display: none;">
                    <button id="walletBtn" class="btn btn-sm btn-outline-primary d-flex align-items-center">
                        <span class="wallet-connected me-2"></span>
                        <span id="walletShort" class="text-truncate" style="max-width: 80px;"></span>
                    </button>
                </div>
            </header>
            
            <!-- Main Content -->
            <div class="tab-content" id="nav-tabContent">
                <!-- Home Tab -->
                <div class="tab-pane fade show active" id="nav-home" role="tabpanel">
                    <!-- User Stats -->
                    <div class="card gradient-bg text-white mb-4">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <div>
                                    <h2 class="h5 mb-1">Welcome back</h2>
                                    <p class="mb-0" id="username">User</p>
                                </div>
                                <div class="text-end">
                                    <h3 class="h4 mb-1" id="userBalance">0 TON</h3>
                                    <p class="small mb-0">Total earned</p>
                                </div>
                            </div>
                            <div class="d-flex justify-content-between">
                                <div>
                                    <p class="h5 mb-1" id="completedCourses">0</p>
                                    <p class="small mb-0">Courses</p>
                                </div>
                                <div class="text-center">
                                    <p class="h5 mb-1" id="referralsCount">0</p>
                                    <p class="small mb-0">Referrals</p>
                                </div>
                                <div class="text-end">
                                    <p class="h5 mb-1" id="certificatesCount">0</p>
                                    <p class="small mb-0">Certificates</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ongoing Courses -->
                    <h2 class="h5 mb-3">Continue Learning</h2>
                    <div id="ongoingCourses" class="mb-4">
                        <div class="card course-card mb-3">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <h3 class="h6 mb-0">TON Smart Contracts</h3>
                                    <span class="badge bg-primary">In Progress</span>
                                </div>
                                <p class="small text-muted mb-2">Learn to build smart contracts on TON</p>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 45%"></div>
                                </div>
                                <button class="btn btn-sm btn-primary w-100 mt-2">Continue</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- TON News Section -->
                    <h2 class="h5 mb-3">TON News</h2>
                    <div id="tonNews" class="mb-4">
                        <div class="card news-card mb-3">
                            <div class="card-body">
                                <h3 class="h6 mb-1">TON Foundation Announces New Grants</h3>
                                <p class="small text-muted mb-2">2 hours ago</p>
                                <p class="small mb-0">The TON Foundation has allocated $50M for ecosystem development...</p>
                            </div>
                        </div>
                        <div class="card news-card mb-3">
                            <div class="card-body">
                                <h3 class="h6 mb-1">New Wallet Feature Released</h3>
                                <p class="small text-muted mb-2">5 hours ago</p>
                                <p class="small mb-0">Latest update includes NFT display and improved security...</p>
                            </div>
                        </div>
                        <button class="btn btn-outline-primary w-100">View All News</button>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="d-grid gap-2 mb-4">
                        <button class="btn btn-primary" id="startLearningBtn">Start Learning</button>
                        <button class="btn btn-outline-primary" id="inviteFriendsBtn">Invite Friends & Earn</button>
                    </div>
                </div>
                
                <!-- Courses Tab -->
                <div class="tab-pane fade" id="nav-courses" role="tabpanel">
                    <h2 class="h5 mb-3">Available Courses</h2>
                    <div id="coursesList">
                        <!-- Course cards will be dynamically inserted here -->
                    </div>
                </div>
                
                <!-- Certificates Tab -->
                <div class="tab-pane fade" id="nav-certificates" role="tabpanel">
                    <h2 class="h5 mb-3">Your Certificates</h2>
                    <div id="certificatesList">
                        <!-- Certificate cards will be dynamically inserted here -->
                    </div>
                </div>
                
                <!-- Profile Tab -->
                <div class="tab-pane fade" id="nav-profile" role="tabpanel">
                    <div class="card mb-4">
                        <div class="card-body">
                            <div class="d-flex align-items-center mb-3">
                                <img src="https://via.placeholder.com/60" alt="User Avatar" class="rounded-circle me-3" style="width: 60px; height: 60px;">
                                <div>
                                    <h3 class="h6 mb-0" id="profileName">User Name</h3>
                                    <p class="small text-muted mb-0" id="profileWallet">Not connected</p>
                                </div>
                            </div>
                            <div class="d-flex justify-content-between mb-3">
                                <div>
                                    <p class="h5 mb-1" id="profileCourses">0</p>
                                    <p class="small text-muted mb-0">Courses</p>
                                </div>
                                <div class="text-center">
                                    <p class="h5 mb-1" id="profileEarned">0 TON</p>
                                    <p class="small text-muted mb-0">Earned</p>
                                </div>
                                <div>
                                    <p class="h5 mb-1" id="profileReferrals">0</p>
                                    <p class="small text-muted mb-0">Referrals</p>
                                </div>
                            </div>
                            <button class="btn btn-outline-primary w-100" id="editProfileBtn">Edit Profile</button>
                        </div>
                    </div>
                    
                    <h2 class="h5 mb-3">Settings</h2>
                    <div class="card mb-3">
                        <div class="card-body">
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="darkModeSwitch" checked>
                                <label class="form-check-label" for="darkModeSwitch">Dark Mode</label>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Language</label>
                                <select class="form-select">
                                    <option>English</option>
                                    <option>Russian</option>
                                    <option>Chinese</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn btn-outline-danger w-100" id="logoutBtn">Log Out</button>
                </div>
            </div>
            
            <!-- Bottom Navigation -->
            <nav class="fixed-bottom bg-dark py-2">
                <ul class="nav nav-tabs justify-content-around border-0">
                    <li class="nav-item">
                        <a class="nav-link active" id="nav-home-tab" data-bs-toggle="tab" href="#nav-home">
                            <i class="bi bi-house-door"></i> Home
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="nav-courses-tab" data-bs-toggle="tab" href="#nav-courses">
                            <i class="bi bi-book"></i> Courses
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="nav-certificates-tab" data-bs-toggle="tab" href="#nav-certificates">
                            <i class="bi bi-award"></i> Certificates
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="nav-profile-tab" data-bs-toggle="tab" href="#nav-profile">
                            <i class="bi bi-person"></i> Profile
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
        
        <!-- Course Detail Modal -->
        <div class="modal fade" id="courseModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="courseModalTitle">Course Title</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p id="courseModalDescription">Course description will appear here.</p>
                        <div class="d-flex justify-content-between mb-3">
                            <div>
                                <small class="text-muted">Difficulty</small>
                                <p id="courseModalDifficulty">Beginner</p>
                            </div>
                            <div>
                                <small class="text-muted">Duration</small>
                                <p id="courseModalDuration">30 min</p>
                            </div>
                            <div>
                                <small class="text-muted">Reward</small>
                                <p id="courseModalReward">0.1-0.5 TON</p>
                            </div>
                        </div>
                        <div class="d-grid gap-2">
                            <button class="btn btn-primary" id="startCourseBtn">Start Course</button>
                            <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Initialize Telegram WebApp
        const tgWebApp = Telegram.WebApp;
        tgWebApp.expand();
        
        // Initialize TonConnect
        const connector = new TonConnect.TonConnect({
            manifestUrl: 'https://ton-education.app/tonconnect-manifest.json'
        });
        
        // App State
        let userState = {
            walletConnected: false,
            walletAddress: null,
            balance: 0,
            completedCourses: 0,
            referrals: 0,
            certificates: 0,
            currentCourse: null,
            username: 'User'
        };
        
        // Sample Courses Data
        const courses = [
            {
                id: 1,
                title: "TON Blockchain Basics",
                description: "Learn the fundamentals of TON Blockchain architecture and how it works.",
                difficulty: "Beginner",
                duration: "15 min",
                reward: "0.1-0.3 TON",
                progress: 0
            },
            {
                id: 2,
                title: "FunC Smart Contracts",
                description: "Master writing smart contracts using FunC language on TON.",
                difficulty: "Intermediate",
                duration: "45 min",
                reward: "0.3-0.7 TON",
                progress: 0
            },
            {
                id: 3,
                title: "TON Wallet Integration",
                description: "Learn how to integrate TON wallets into your applications.",
                difficulty: "Advanced",
                duration: "30 min",
                reward: "0.2-0.5 TON",
                progress: 0
            }
        ];
        
        // Sample Certificates Data
        const certificates = [
            {
                id: 1,
                course: "TON Blockchain Basics",
                date: "2023-10-15",
                reward: "0.25 TON",
                nftId: "EQABC123"
            }
        ];
        
        // Sample TON News Data
        const tonNews = [
            {
                title: "TON Foundation Announces New Grants",
                time: "2 hours ago",
                content: "The TON Foundation has allocated $50M for ecosystem development grants to support builders in the TON space."
            },
            {
                title: "New Wallet Feature Released",
                time: "5 hours ago",
                content: "Latest update includes NFT display and improved security features for all TON wallets."
            },
            {
                title: "TON Partners with Major Exchange",
                time: "1 day ago",
                content: "TON blockchain now integrated with Binance for direct deposits and withdrawals."
            }
        ];
        
        // DOM Elements
        const loadingElement = document.getElementById('loading');
        const appElement = document.getElementById('app');
        const walletInfoElement = document.getElementById('walletInfo');
        const walletShortElement = document.getElementById('walletShort');
        const connectWalletBtn = document.getElementById('connectWalletBtn');
        const usernameElement = document.getElementById('username');
        const userBalanceElement = document.getElementById('userBalance');
        const completedCoursesElement = document.getElementById('completedCourses');
        const referralsCountElement = document.getElementById('referralsCount');
        const certificatesCountElement = document.getElementById('certificatesCount');
        const coursesListElement = document.getElementById('coursesList');
        const certificatesListElement = document.getElementById('certificatesList');
        const darkModeSwitch = document.getElementById('darkModeSwitch');
        const courseModal = new bootstrap.Modal(document.getElementById('courseModal'));
        
        // Initialize App
        function initApp() {
            // Set theme based on user preference
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            document.body.setAttribute('data-theme', prefersDark ? 'dark' : 'light');
            darkModeSwitch.checked = prefersDark;
            
            // Load user data
            loadUserData();
            
            // Render courses
            renderCourses();
            
            // Render 
